{{define "totp"}}{{template "layout" .}}{{end}}
{{define "body"}}
<div class="max-w-2xl mx-auto bg-slate-900/70 border border-slate-800 rounded-xl shadow p-6 space-y-4">
  <a href="/ui" class="text-sm text-emerald-300">← 返回控制面板</a>
  <h1 class="text-2xl font-semibold">TOTP 设置</h1>
  <p class="text-sm text-slate-300">使用以下信息配置新的 TOTP 令牌。保存后旧令牌将失效。</p>
  <div class="grid md:grid-cols-2 gap-4 items-center">
    {{if .QRCode}}
    <div class="bg-white p-4 rounded-lg">
      <img src="{{.QRCode}}" alt="TOTP QR Code" class="mx-auto">
    </div>
    {{else}}
    <div class="bg-slate-800 border border-slate-700 text-center rounded-lg p-4 text-sm text-slate-300">
      暂无二维码，请使用下方密钥手动添加。
    </div>
    {{end}}
    <div class="space-y-2 text-sm">
      <p><span class="font-semibold text-emerald-200">账户:</span> {{.Username}}</p>
      <p><span class="font-semibold text-emerald-200">密钥:</span> <span class="font-mono break-all">{{.Secret}}</span></p>
      <p><span class="font-semibold text-emerald-200">URL:</span> <span class="text-xs break-all">{{.ProvisioningURL}}</span></p>
      <p>支持 Google Authenticator、1Password、Authy 等兼容 TOTP 的客户端。</p>
    </div>
  </div>
  <form method="post" action="/ui/totp" class="space-y-3">
    <input type="hidden" name="csrf" value="{{.CSRF}}">
    <label class="block text-sm">请输入新的 TOTP 动态码以确认更新</label>
    <input name="totp" class="w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2" placeholder="000000" inputmode="numeric" pattern="[0-9]{6}" required>
    <button class="bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-semibold px-4 py-2 rounded-md">确认并启用新密钥</button>
  </form>
</div>
{{end}}
